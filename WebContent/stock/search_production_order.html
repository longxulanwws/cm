<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <title>查看生产订单</title>
        
        <link rel="stylesheet" type="text/css" href="../css/cm-default.css"  />
        <link rel="stylesheet" type="text/css" href="../ligerUI/skins/Aqua/css/ligerui-all.css" />
        <link rel="stylesheet" type="text/css" href="../ligerUI/skins/ligerui-icons.css" />
        <script src="../js/jquery.js" type="text/javascript"></script>
        <script src="../js/validate/jquery.validate.js" type="text/javascript"></script>
        <script src="../js/validate/jquery.metadata.js" type="text/javascript"></script>
        <script src="../js/validate/messages_zh.js" type="text/javascript"></script>
        <script src="../ligerUI/js/ligerui.all.js" type="text/javascript"></script>
        <script src="../js/common.js" type="text/javascript"></script>
        <script type="text/javascript">
            var pGrid, c_row, opt, c_code;
            var udata;
            var num = 0;
            $(function(){   
                udata = getData('user',{orgid:$("#deptCodeS").val()},false);
                $("#layout_main").ligerLayout({
                    bottomHeight: "35%",
                    allowBottomResize:false
                });
                $("form").ligerForm();
                $(".l-textarea").each(function(index){
                    $(this).removeClass("l-textarea");
                });
                $("#d-menu").ligerToolBar({items:[
                    {text:'返回',click:toBack,icon:'back'},
                     {line:true}
                ]});
                pGrid = $("#p-div").ligerGrid({
                    columns:[
                        {display:'任务编号',name:'code',width:160},
                        {display:'计划任务类型',name:'type',type:'string',width:160,render:function(item){return paramRender(item,'task_type',item.type);}},
                        {display:'任务名称',name:'name',width:160,editor:{type:'string'}},
                        {display:'任务开始日期',name:'date_start',type: 'string',  width: 100},
                        {display:'计划结束日期',name:'date_planned',type: 'string',  width: 100}
                    ],
                    pageSize:20,
                    usePager: true,
                    width:'100%',
                    height:'100%',
                    dataAction:'server',
                    url: '../common/q.jsp', 
                    checkbox:false,
                    rownumbers:true,
                    fixedCellHeight:false,
                    colDraggable:false,
                    enabledEdit:true,
                    clickToEdit:true,
                    onSelectRow:function(rowdata, rowindex){$("#txtrowindex").val(rowindex);},
                    onReload: queryProd,
                });
                // 下拉框 数据 处理
                //生产类型
                var typeins = $("#typeInS").ligerComboBox({
                    autocomplete: true,
                    valueField:'value',
                    textField:'name',
                    data:get_production_type,
                    onSelected:function(v,t) {
                        $("#typeS").val(v);
                    }
                });
                //负责人
                $("#useridInS").ligerComboBox({
                    autocomplete: true,
                    valueField:'value',
                    textField:'name',
                    data:udata,
                    onSelected:function(v,t) {
                        $("#userIdS").val(v);
                    }
                });
                var query = getQueryString(window.location.toString());
                c_code = query.code;
                var param = {code:c_code};
                var data = JSON.stringify(reqObj('q','stock.select.production_order.query',JSON.stringify(param)));
                ajaxSubmit("/cm/rbac/cm.do?m=c", data, function(data) {
                    bindVal(data['data']);
                }, null, false);
                param = {production_code:c_code};
                data = JSON.stringify(reqObj('q','stock.select.production_line.query',JSON.stringify(param)));
                ajaxSubmit("/cm/rbac/cm.do?m=c", data, function(data) {
                    pGrid.set({data: data['data']});
                }, null, false);
              $("#pageloading").hide();
            });
            //生产类型下拉框获取值
             var get_production_type=new function () {
                    return getData('pro_type');
                }
          
            function queryProd(){
                var query = getQueryString(window.location.toString());
                c_code = query.code;
                var param = {code:c_code};
                var data = JSON.stringify(reqObj('q','stock.select.production_order.query',JSON.stringify(param)));
                ajaxSubmit("/cm/rbac/cm.do?m=c", data, function(data) {
                    bindVal(data['data']);
                }, null, false);
                param = {production_code:c_code};
                data = JSON.stringify(reqObj('q','stock.select.production_line.query',JSON.stringify(param)));
                ajaxSubmit("/cm/rbac/cm.do?m=c", data, function(data) {
                    pGrid.set({data: data['data']});
                }, null, false);            	
            }

            // 查询时数据值绑定  应该可以抽象为公共的功能
            function bindVal(data) {
                if (data.Rows && data.Rows.length === 1) {
                    data = data.Rows[0];
                    $('#codeS').val(data.code);
                    $('#nameS').val(data.name);
                    $('#typeInS').val(paramRender(null,'pro_type',data.type));
                    $('#typeS').val(data.type);
                    $('#OriginS').val(data.origin);
                    $('#partner_nameS').val(paramRender(null,'partner_list',data.partner_id));
                    $('#partner_idS').val(data.partner_id);                 
                    $('#product_nameS').val(data.product_name);
                    $('#product_codeS').val(data.product_code);
                    $('#product_qtyS').val(data.product_qty);
                    $('#product_uomS').val(data.product_uom);
                    $('#date_startS').val(data.date_start);
                    $('#date_plannedS').val(data.date_planned);
                    $('#useridInS').val(paramRender(null,'user',data.user_id));
                    $('#userIdS').val(data.user_id);
                    $('#hour_total').val(data.hour_total);
                    $('#Bom_code').val(data.bom_code);
                    $('#Draw_code').val(data.production_draw_code);
                    $('#noteS').val(data.note);
                    $('#deptS').val(paramRender(null,'org_list',data.dept_id));
                    $('#deptCodeS').val(data.dept_id);
                    $('#createUserS').val(paramRender(null,'user',data.createuser));
                    $('#createUserCodeS').val(data.createuser);
                    $('#createDateS').val(data.createdate);
                }
            }
            
            //界面的返回处理，实际是关闭标签处理。
            function toBack()
            {
                //关闭查看界面
            	parent.tabManager.removeTabItem("new_search_stockS"+$('#codeS').val());
             }
        </script>
        <style type="text/css">
            .center-height{height: 100%;}
        </style>
    </head>
    <body style="padding:0;">
        <div id="pageloading"></div>
        <div id="layout_main">
            <div position="center" id="a_center" title="基本信息" style="overflow:auto;">
                <div id="d-menu" class="toolbar"></div>
                <div style="height:25px;"></div>
                <form name="basic-form" method="post" id="basic_form" class="liger-form" data-validate="{}">
                    <div class="line-div">
                        <div class="label-div"><label>订单编号</label></div>
                        <div class="in-div"><input type="text" id="codeS" ltype="text" class="readonly diff" readonly="readonly" /></div>
                        <div class="label-div"><label>订单名称</label></div>
                        <div class="in-div"><input type="text" id="nameS" ltype="text" class="required diff" readonly="readonly"/></div>
                    </div>
                    <div class="line-div">
                        <div class="label-div"><label>生产类型</label></div>
                        <div class="in-div">
                        <input type="text" id="typeInS" ltype="combobox" class="required diff" readonly="readonly"/>
                        <input type="hidden" id="typeS" />
                        </div>
                        <div class="label-div"> <label>合同编号</label></div>
                        <div class="in-div"><input type="text" id="OriginS" ltype="text" class="required diff" readonly="readonly"/></div>
                    </div>
                     <div class="line-div">
                        <div class="label-div"><label>客户名称</label></div>
                        <div class="in-div"><input type="text" id="partner_nameS" ltype="text" class="required diff" readonly="readonly"  />
                        <input type="hidden" id="partner_idS" />
                        </div>
                        <div class="label-div"><label>产品名称</label></div>
                        <div class="in-div"><input type="text" id="product_nameS" ltype="text" class="required diff" readonly="readonly" />
                        <input type="hidden" id="product_codeS" />
                        </div>
                    </div>
                     <div class="line-div">
                        <div class="label-div"><label>生产数量</label></div>
                        <div class="in-div"><input type="text" id="product_qtyS" ltype="text" class="required diff" readonly="readonly" /></div>
                        <div class="label-div"><label>计量单位</label></div>
                        <div class="in-div"><input type="text" id="product_uomS" ltype="text" class="required diff" readonly="readonly" /></div>
                    </div>
                    <div class="line-div">
                        <div class="label-div"><label>下单日期</label></div>
                        <div class="in-div"><input type="text" id="date_startS" ltype="text" class="required diff" readonly="readonly" /></div>
                        <div class="label-div"><label>交货日期</label></div>
                        <div class="in-div"><input type="text" id="date_plannedS" ltype="text" class="required diff" readonly="readonly" /></div>
                    </div>
                    <div class="line-div">
                        <div class="label-div"><label>负责人</label></div>
                         <div class="in-div"><input type="text" id="useridInS" ltype="combobox" class="required diff" readonly="readonly" /></div>
                        <input type="hidden" id="userIdS" />
                        <div class="label-div"><label>总工时</label></div>
                        <div class="in-div"><input type="text" id="hour_total" ltype="text" class="required diff" readonly="readonly" readonly="readonly" /></div>
                    </div>
                    <div class="line-div">
                        <div class="label-div"><label>BOM清单编号</label></div>
                        <div class="in-div"><input type="text" id="Bom_code" ltype="text" class="required diff" readonly="readonly" /></div>
                        <div class="label-div"><label>生产设计图纸编号</label></div>
                        <div class="in-div"><input type="text" id="Draw_code" ltype="text" class="required diff" readonly="readonly" /></div>
                    </div>
                    <div class="line-div" style="height:76px;">
                        <div class="label-div"><label>备注</label></div>
                        <div class="in-div" style="width:72%;">
                            <textarea cols="80" rows="2" id="noteS" readonly="readonly" ></textarea>
                        </div>
                    </div>
                    <div class="line-div">
                        <div class="label-div"><label>制单部门</label></div>
                        <div class="in-div"><input type="text" id="deptS" ltype="text" class="readonly diff" readonly="readonly" /></div>
                        <input type="hidden" id="deptCodeS" />
                        <div class="label-div"><label>制单人</label></div>
                        <div class="in-div"><input type="text" id="createUserS" ltype="text" class="readonly diff" readonly="readonly" /></div>
                        <input type="hidden" id="createUserCodeS" />
                        <input type="hidden" id="WriteUserCodeS" />
                        <input type="hidden" id="WriteDateS" />
                    </div>
                    <div class="line-div">
                        <div class="label-div"><label>制单时间</label></div>
                        <div class="in-div"><input type="text" id="createDateS" ltype="text" class="readonly diff" readonly="readonly" /></div>
                    </div>
                </form>
            </div>
            <div position="bottom" id="a_right" title="任务选择列表">
                <div id="p-div"></div>
            </div>
        </div>
    </body>
</html>