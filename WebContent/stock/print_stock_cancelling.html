<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<title>打印原材料出库单</title>
		
		<link rel="stylesheet" type="text/css" href="../css/cm-default.css"  />
		<link rel="stylesheet" type="text/css" href="../ligerUI/skins/Aqua/css/ligerui-all.css" />
		<link rel="stylesheet" type="text/css" href="../ligerUI/skins/ligerui-icons.css" />
		<script src="../js/jquery.js" type="text/javascript"></script>
		<script src="../ligerUI/js/ligerui.all.js" type="text/javascript"></script>
		<script src="../js/common.js" type="text/javascript"></script>
		<script type="text/javascript">
		var qs;
		var codeQ = window.location.toString().replace(/^[^?]+\?id=/, '');
		
			$(function(){
				qs = getQueryString(window.location.toString());
				//alert(qs);
				$("#d-menu").ligerToolBar({items:[
				    {text:'打印',click:function() {
					    window.print();
					    var param = {
							id: $('#id').val(),
							state: "60",
							flow_state: $('#flow_state').val()
					    };
	                
						ajaxSubmit("/cm/rbac/cm.do?m=u", JSON.stringify(
								reqObj('u','stock.update.picking_state.update', JSON.stringify(param))),
							function(data) {
								if (data) {
									if (parseInt(data['status']) > 0) {								
										$.ligerDialog.success('打印成功');
									} else {								
										$.ligerDialog.error('打印失败');
									}
								}
						});
				    }, icon:'print'},
					{line:true}
				]});
				toQuery();
				
				$("#pageloading").hide();
			});
// 			window.onafterprint = function() {
// 				alert("printed.");
// 			}
			var minLine = 10;
			var tr = '<tr><td>${code}</td><td>${name}</td><td>${specs}</td><td>${brand}</td><td>${product_uom}</td><td>${product_qty}</td></tr>';
			function toQuery() {
				//var codeQ = qs.id;
				//codeQ
				alert(codeQ);
				//时间
				var data = JSON.stringify(reqObj('q','stock.select.picking.query',JSON.stringify({code:codeQ})));
				ajaxSubmit("/cm/rbac/cm.do?m=c", data, function(data) {
					var picking = data.data.Rows[0];
					$("#partnerS").val(picking.partner_id);
					$("#codeS").val(picking.code);
					$("#originS").val(picking.origin);
					$("#warehoseS").val(picking.warehose_id);
				}, null, false);
				ajaxSubmit("/cm/rbac/cmUser.do?method=getUserInfo", null, function(data) {
					$("#moveInDateS").val(data['date']);
				}, null, false);

				data = JSON.stringify(reqObj('q','stock.select.move.query',JSON.stringify({picking_id:codeQ})));
				ajaxSubmit("/cm/rbac/cm.do?m=c", data, function(data) {
					var moves = data.data.Rows;
					var ta = "";
					for (var i = 0; i < moves.length; i++) {
						ta = ta.concat(tr.replace(/\$\{code\}/, moves[i].code)
								.replace(/\$\{name\}/, moves[i].name)
								.replace(/\$\{specs\}/, moves[i].specs)
								.replace(/\$\{brand\}/, paramRender(null,'brand',moves[i].brand))
								.replace(/\$\{product_uom\}/, paramRender(null,'uom',moves[i].product_uom))
								.replace(/\$\{product_qty\}/, parseInt(moves[i].product_qty).toFixed(0)));
					}
					if (moves.length < minLine) {
						for (var i = 0; i < minLine - moves.length; i++)
							ta = ta.concat(tr.replace(/\$\{[^}]+\}/g, ''));
					}
					$('#moveT').append(ta);
				});
			}
	    </script>
		<style type="text/css" media="print">
			.no-print{display:none;}
		</style>
		<style type="text/css">
			.print-content{text-align:center;padding:5px;overflow:auto;}
			h1{margin-top:10px;font-family:"宋体",Arial,sans-serif;font-weight:900;}
			table {font-family:"宋体",Arial,sans-serif;font-size:12px;border:none;}
			table.content{width:100%;}
			table.content td{text-align:center;}
			table.no-border{width:90%;}
			table.grid{width:90%;font-family:"宋体",Arial,sans-serif;font-size:16px;border:1px solid #000000;table-layout:auto;}
			table.grid th{text-align:center;font-weight:600;height:28px;border:1px solid #000000;background-color: #EEEEEE;}
			table.grid td{border:1px solid #000000;height:25px;word-break:break-all;}
			.no-border tr{height:50px;}
			.no-border th{font-family:"宋体",Arial,sans-serif;font-size:1.2em;font-weight:800;vertical-align:bottom;padding-left:10px;}
			.no-border td{border-bottom:1px solid #000000;}
			.no-border span{text-decoration:underline;font-size:1.0em;font-weight:normal;}
		</style>
	</head>
	<body style="padding:0;">
		<div id="pageloading"></div>  
		<div id="d-menu" class="no-print"></div>
		<div id="d-content" class="print-content">
			<table class="content">
				<thead>
					<tr style="height:60px;">
						<td><h1>原材料退库单</h1></td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td style="padding-left:7.5%;">
							<table class="no-border">
								<tr>
									<th style="width:40%;">退库部门：<span id="partnerS"></span></th>
									<th style="width:27%;">退库日期：<span id="moveInDateS"></span></th>
									<th style="width:33%;">NO：<span id="codeS"></span></th>
								</tr>
								<tr style="height:10px;"><th colspan="3"></th></tr>
							</table>
						</td>
					</tr>
					<tr>
						<td style="padding-left:7.5%;">
							<table class="grid">
								<thead>
									<tr>
										<th style="width:15%">商品编号</th>
										<th style="width:20%">商品名称</th>
										<th style="width:20%">规格/型号</th>
										<th style="width:20%">品牌</th>
										<th style="width:10%">单位</th>
										<th style="width:15%">退库数量</th>
									</tr>
								</thead>
								<tbody id="moveT"></tbody>
							</table>
						</td>
					</tr>
					<tr>
						<td style="padding-left:7.5%;">
							<table class="no-border">
								<tr style="height:22px;">
									<th>退库人：<span id=""></span></th>
									<th>保管员：<span id=""></span></th>
									<th>核算员：<span id=""></span></th>
								</tr>
								<tr style="height:22px;">
									
									<th colspan="3">备注：<span id=""></span></th>
								</tr>
							</table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</body>
</html>